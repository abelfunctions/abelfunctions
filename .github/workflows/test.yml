# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Test

on: [push, pull_request]

jobs:
  build:
    env:
      SAGE: ${HOME}/SageMath/sage
    runs-on: ubuntu-18.04
    strategy:
      matrix:
       include:
         - SAGE_TARBALL: sage-8.6-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit/old
         - SAGE_TARBALL: sage-8.7-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit/old
         - SAGE_TARBALL: sage-8.8-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit/old
         - SAGE_TARBALL: sage-8.9-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit/old
         - SAGE_TARBALL: sage-9.0-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit/old
         - SAGE_TARBALL: sage-9.1-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit
         - SAGE_TARBALL: sage-9.2-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit
         - SAGE_TARBALL: sage-9.3-Ubuntu_18.04-x86_64.tar.bz2
           SAGE_SERVER: http://mirrors.mit.edu/sage/linux/64bit
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install SageMath
        run: |
          gcc --version
          sudo apt-get install aria2 pbzip2
          aria2c ${SAGE_SERVER}/${SAGE_TARBALL} --timeout=300
          pbzip2 -dc ${HOME}/${SAGE_TARBALL} | tar xf -
      - name: Install Python test dependencies
        run: ${SAGE} -pip install pytest-xdist pytest==4.6.4
      - name: Install Abelfunctions
        run: ${SAGE} setup.py build_ext --inplace
      - name: Run tests
        run: ${SAGE} runtests.py -v

