# This workflow tests Abelfunctions against various versions of SageMath

name: Test

on: [push]

jobs:
  test:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        sage-version:
          - '9.2'
          - '9.3'
          - '9.4'
          - '9.5'
          - '9.6'
          - '9.7'
          - '9.8'
    steps:
      - name: Install sage
        run: |
          conda config --add channels conda-forge
          conda install mamba -y
          $CONDA/bin/mamba create -n sage sage=${{ matrix.sage-version }} -y
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install Python test dependencies
        run: $CONDA/bin/mamba run -n sage sage -pip install -r test-requirements.txt
      - name: Install Abelfunctions
        run: $CONDA/bin/mamba run -n sage sage setup.py build_ext --inplace
      - name: Run tests
        run: $CONDA/bin/mamba run -n sage sage runtests.py -v

  test-pip-install:
    runs-on: ubuntu-22.04
    steps:
      - name: Install sage
        run: sudo apt update && sudo apt install sagemath
      - name: Install Python test dependencies
        run:  sage -pip install -r test-requirements.txt
      - name: Install Abelfunctions using pip
        run:  sage --pip install git+https://github.com/abelfunctions/abelfunctions@${{ github.ref_name }}
